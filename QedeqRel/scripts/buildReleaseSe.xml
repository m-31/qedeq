<?xml version="1.0" encoding="ISO-8859-1"?>
<!-- $Id: buildReleaseSe.xml,v 1.32 2008/05/16 19:19:22 m31 Exp $ -->
<!-- $RCSfile: buildReleaseSe.xml,v $ -->
<!-- $Revision: 1.32 $ -->
<!-- author: mime -->
<!-- project: Hilbert II -->

<!-- This is the Ant build file for building the Se release of project Hilbert II -->
<project name="Hilbert II" default="all" basedir="../..">

  <!-- set global properties for this build -->
  <property file="${basedir}/QedeqRel/conf/build.properties" />
  <property name="qedeq.se.test.src"     value="${basedir}/QedeqKernelSeTest/src" />
  <property name="qedeq.se.test.data"    value="${basedir}/QedeqKernelSeTest/data" />
  <property name="qedeq.lib"             value="${basedir}/QedeqLib" />
  <property name="qedeq.gen"             value="${basedir}/../../qedeq_gen" />
  <property name="qedeq.se.gen"          value="${basedir}/../../qedeq_gen/release/se" />
  <property name="qedeq.se.dest"         value="${basedir}/../../qedeq_gen/release/se/dest/qedeq" />
  <property name="qedeq.se.dist"         value="${basedir}/../../qedeq_gen/release/se/dist" />
  <property name="qedeq.se.temp"         value="${basedir}/../../qedeq_gen/release/se/temp" />
  <property name="qedeq.se.webstart"     value="${basedir}/../../qedeq_gen/release/se/webstart" />
  <property name="qedeq.gen.doc"         value="${basedir}/../../qedeq_gen" />
  <property name="qedeq.se.doc"          value="${basedir}/QedeqRel/doc/se" />
  <property name="qedeq.se.rel"          value="${basedir}/QedeqRel/inc/se" />
  <property name="qedeq.rel.src"         value="${basedir}/QedeqRel/src" />
  <property name="qedeq.rel.images"      value="${basedir}/QedeqRel/inc/images" />
	
  <taskdef resource="checkstyletask.properties" classpath="${qedeq.lib}/checkstyle-all-4.4.jar" />
	
  <taskdef name="java2html"
    classname="de.java2html.anttasks.Java2HtmlTask"
    classpath="${qedeq.lib}/java2html.jar"
  />
	
  <path id="classpath.common">
      <pathelement location="${qedeq.lib}/junit.jar"/>
      <pathelement location="${qedeq.lib}/xercesImpl.jar" />
      <pathelement location="${qedeq.lib}/xml-apis.jar" />
      <pathelement location="${qedeq.lib}/xalan.jar" />
      <pathelement location="${qedeq.lib}/commons-logging-1.1.jar" />
      <pathelement location="${qedeq.lib}/log4j-1.2.14.jar" />
      <pathelement location="${qedeq.lib}/forms-1.1.0.jar" />
      <pathelement location="${qedeq.lib}/looks-2.1.4.jar" />
  	
  	  <pathelement location="${qedeq.se.dest}/src/eclipse/QedeqBase/bin" />
	  <pathelement location="${qedeq.se.dest}/src/eclipse/QedeqBaseTest/bin" />
	  <pathelement location="${qedeq.se.dest}/src/eclipse/QedeqKernelSe/bin" />
	  <pathelement location="${qedeq.se.dest}/src/eclipse/QedeqKernelSeTest/bin" />
	  <pathelement location="${qedeq.se.dest}/src/eclipse/QedeqKernelBo/bin" />
	  <pathelement location="${qedeq.se.dest}/src/eclipse/QedeqKernelBoTest/bin" />
	  <pathelement location="${qedeq.se.dest}/src/eclipse/QedeqKernelXml/bin" />
	  <pathelement location="${qedeq.se.dest}/src/eclipse/QedeqKernelXmlTest/bin" />
	  <pathelement location="${qedeq.se.dest}/src/eclipse/QedeqGuiSe/bin" />
  	
  </path>

  <path id="srcpath.common">
  	  <pathelement location="${qedeq.se.dest}/src/eclipse/QedeqBase/src" />
	  <pathelement location="${qedeq.se.dest}/src/eclipse/QedeqBaseTest/src" />
	  <pathelement location="${qedeq.se.dest}/src/eclipse/QedeqKernelSe/src" />
	  <pathelement location="${qedeq.se.dest}/src/eclipse/QedeqKernelSeTest/src" />
	  <pathelement location="${qedeq.se.dest}/src/eclipse/QedeqKernelBo/src" />
	  <pathelement location="${qedeq.se.dest}/src/eclipse/QedeqKernelBoTest/src" />
	  <pathelement location="${qedeq.se.dest}/src/eclipse/QedeqKernelXml/src" />
	  <pathelement location="${qedeq.se.dest}/src/eclipse/QedeqKernelXmlTest/src" />
	  <pathelement location="${qedeq.se.dest}/src/eclipse/QedeqGuiSe/src" />
  </path>

  <tstamp>
      <format property="qedeq.se.timestamp" pattern="yyyy-MM-dd HH:mm:ss"/>
  </tstamp>

  <filterset id="qedeq_filter" begintoken="@" endtoken="@">
      <filter token="QEDEQ_VERSION"     value="${qedeq.working.version}" />
      <filter token="QEDEQ_CODENAME"    value="${qedeq.working.codename}" />
      <filter token="QEDEQ_DIRECTORY"   value="${qedeq.working.directory}" />
      <filter token="QEDEQ_TIMESTAMP"   value="${qedeq.se.timestamp}" />
      <filter token="trace_file_path"   value="./log/trace.txt" />
  </filterset>

  <taskdef name="xsddoc" classname="net.sf.xframe.xsddoc.Task" classpath="${qedeq.lib}/xsddoc.jar" />
		
  <target name="init">
  	<delete dir="${qedeq.se.dest}"/>
    <mkdir dir="${qedeq.se.dest}"/>
  	<delete dir="${qedeq.se.dist}"/>
    <mkdir dir="${qedeq.se.dist}"/>
  	<delete dir="${qedeq.se.temp}"/>
    <mkdir dir="${qedeq.se.temp}"/>
  </target>


  <target name="sourceKernel" depends="init">
  	<delete dir="${qedeq.se.dest}/src/eclipse"/>
	<antcall target="copySource"><param name="QedeqModule" value="QedeqBase"/></antcall>
	<antcall target="copySource"><param name="QedeqModule" value="QedeqBaseTest"/></antcall>
	<antcall target="copySource"><param name="QedeqModule" value="QedeqKernelSe"/></antcall>
	<antcall target="copySource"><param name="QedeqModule" value="QedeqKernelSeTest"/></antcall>
	<antcall target="copySource"><param name="QedeqModule" value="QedeqKernelBo"/></antcall>
	<antcall target="copySource"><param name="QedeqModule" value="QedeqKernelBoTest"/></antcall>
    <mkdir dir="${qedeq.se.dest}/src/eclipse/QedeqKernelBoTest/data" />
    <copy todir="${qedeq.se.dest}/src/eclipse/QedeqKernelBoTest/data" >
      <fileset dir="${basedir}/QedeqKernelBoTest/data" />
    </copy>
	<antcall target="copySource"><param name="QedeqModule" value="QedeqKernelXml"/></antcall>
	<antcall target="copySource"><param name="QedeqModule" value="QedeqKernelXmlTest"/></antcall>
  </target>  

  <!-- for antcalls with parameter ${QedeqModule} -->
  <target name="copySource" >
    <echo>Copying module sources: ${QedeqModule}</echo>
  	<mkdir dir="${qedeq.se.dest}/src/eclipse/${QedeqModule}"/>
    <mkdir dir="${qedeq.se.dest}/src/eclipse/${QedeqModule}/src"/>
    <copy todir="${qedeq.se.dest}/src/eclipse/${QedeqModule}/src" >
      <fileset dir="${basedir}/${QedeqModule}/src"
      />
    </copy>
    <copy todir="${qedeq.se.dest}/src/eclipse/${QedeqModule}/" >
      <fileset dir="${basedir}/${QedeqModule}/"
      	includes=".checkstyle,.project"
      />
    </copy>
  </target>

  <target name="compileKernel" depends="sourceKernel">
	<antcall target="compileModule"><param name="QedeqModule" value="QedeqBase"/></antcall>
	<antcall target="compileModule"><param name="QedeqModule" value="QedeqKernelSe"/></antcall>
	<antcall target="compileModule"><param name="QedeqModule" value="QedeqKernelBo"/></antcall>
	<antcall target="compileModule"><param name="QedeqModule" value="QedeqKernelXml"/></antcall>
	<antcall target="compileModule"><param name="QedeqModule" value="QedeqBaseTest"/></antcall>
	<antcall target="compileModule"><param name="QedeqModule" value="QedeqKernelSeTest"/></antcall>
	<antcall target="compileModule"><param name="QedeqModule" value="QedeqKernelBoTest"/></antcall>
	<antcall target="compileModule"><param name="QedeqModule" value="QedeqKernelXmlTest"/></antcall>
  </target>

  <!-- for antcalls with parameter ${QedeqModule} -->
  <target name="compileModule">
    <echo>Compile module sources: ${QedeqModule}</echo>
  	<mkdir dir="${qedeq.se.dest}/src/eclipse/${QedeqModule}/bin"/>
    <javac compiler="javac1.4" 
      srcdir="${qedeq.se.dest}/src/eclipse/${QedeqModule}/src"
      destdir="${qedeq.se.dest}/src/eclipse/${QedeqModule}/bin"
      debug="on"
      deprecation="on"
      classpathref="classpath.common" 
      source="1.4"
      target="1.4"
    />
    <copy todir="${qedeq.se.dest}/src/eclipse/${QedeqModule}/bin">
      <fileset dir="${qedeq.se.dest}/src/eclipse/${QedeqModule}/src"
	       includes="**/*.xsd,**/*.gif,**/*.png,**/*.properties,**/*.xml"
       />
    </copy>
  </target>

  <target name="sourceGui" depends="sourceKernel">
	<antcall target="copySource"><param name="QedeqModule" value="QedeqGuiSe"/></antcall>
  </target>  

  <target name="compileGui" depends="sourceGui,compileKernel">
	<antcall target="compileModule"><param name="QedeqModule" value="QedeqGuiSe"/></antcall>
  </target>

  <target name="sourceDoc" depends="sourceKernel,sourceGui">
	<antcall target="sourceDocModule"><param name="QedeqModule" value="QedeqBase"/></antcall>
	<antcall target="sourceDocModule"><param name="QedeqModule" value="QedeqKernelSe"/></antcall>
	<antcall target="sourceDocModule"><param name="QedeqModule" value="QedeqKernelBo"/></antcall>
	<antcall target="sourceDocModule"><param name="QedeqModule" value="QedeqKernelXml"/></antcall>
  </target>

  <!-- for antcalls with parameter ${QedeqModule} -->
  <target name="sourceDocModule">
    <echo>Java2Html module: ${QedeqModule}</echo>
	<java2html
	       srcdir="${qedeq.se.dest}/src/eclipse/${QedeqModule}/src"
	       destdir="${qedeq.se.dest}/src/results/src/${QedeqModule}"
	       includes="**/*.java"
	       style="eclipse"
	       showLineNumbers="true"
	       showFileName="true"
	       showTableBorder="true"
		>
	</java2html>

  </target>
	
	
  <target name="checkstyle" description="Generation of Checkstyle Reports" depends="sourceKernel,sourceGui,compileKernel,compileGui">
    <mkdir dir="${qedeq.se.dest}/src/results/checkstyle" />
    <mkdir dir="${qedeq.se.dest}/src/results/checkstyle/src" />
  	<copy todir="${qedeq.se.dest}/src/results/checkstyle/src">
  	  <fileset dir="${qedeq.se.dest}/src/eclipse/QedeqBase/src" includes="**/*.java,**/package.html" />
      <fileset dir="${qedeq.se.dest}/src/eclipse/QedeqKernelSe/src" includes="**/*.java,**/package.html" />
      <fileset dir="${qedeq.se.dest}/src/eclipse/QedeqKernelBo/src" includes="**/*.java,**/package.html" />
      <fileset dir="${qedeq.se.dest}/src/eclipse/QedeqKernelXml/src" includes="**/*.java,**/package.html" />
      <fileset dir="${qedeq.se.dest}/src/eclipse/QedeqGuiSe/src" includes="**/*.java,**/package.html" />
    </copy>

    <pathconvert property="checkstyle.basedir">
	  <path location="${qedeq.se.dest}/src/results/checkstyle" />
    </pathconvert>
  	
  	<echo>${checkstyle.basedir}</echo>
  	
  	<checkstyle config="${qedeq.se.rel}/checkstyle_config.xml"
                failureProperty="checkstyle.failure"
                failOnViolation="false"
  		        classpathref="classpath.common"
  	>
      <formatter type="xml" tofile="${qedeq.se.dest}/src/results/checkstyle/checkstyle_report.xml"/>
  	  <fileset dir="${qedeq.se.dest}/src/results/checkstyle/src" />
    </checkstyle>
  	
  	<!-- the following line has effect!!! :((( -->
  	<replace file="${qedeq.se.dest}/src/results/checkstyle/checkstyle_report.xml" 
  	  token="${checkstyle.basedir}"
  	  value=""
  	/>
  	<xslt in="${qedeq.se.dest}/src/results/checkstyle/checkstyle_report.xml" 
  		out="${qedeq.se.dest}/src/results/checkstyle/index.html" 
  		style="${qedeq.se.rel}/checkstyle-no-frames-detailed.xsl">
  		<param name="basedir" expression="${checkstyle.basedir}"/>
  	</xslt>
  </target>

  <target name="test" depends="compileKernel,compileGui">
	<antcall target="testModule"><param name="QedeqModule" value="QedeqBase"/></antcall>
	<antcall target="testModule"><param name="QedeqModule" value="QedeqKernelSe"/></antcall>
    <mkdir dir="${qedeq.se.dest}/src/results/junit/QedeqKernelBo/data" />
    <copy todir="${qedeq.se.dest}/src/results/junit/QedeqKernelBo/data" >
      <fileset dir="${basedir}/QedeqKernelBoTest/data" />
    </copy>
  	<mkdir dir="${qedeq.se.dest}/src/results/junit/QedeqDoc"/>
    <copy todir="${qedeq.se.dest}/src/results/junit/QedeqDoc" >
      <fileset dir="${basedir}/QedeqDoc" />
    </copy>
	<antcall target="testModule"><param name="QedeqModule" value="QedeqKernelBo"/></antcall>
	<antcall target="testModule"><param name="QedeqModule" value="QedeqKernelXml"/></antcall>
  </target>

  <!-- for antcalls with parameter ${QedeqModule} -->
  <target name="testModule">
    <echo>Test module: ${QedeqModule}</echo>
  	<mkdir dir="${qedeq.se.dest}/src/results/junit/${QedeqModule}"/>
  	<mkdir dir="${qedeq.se.dest}/src/results/junit/${QedeqModule}/log"/>
  	<mkdir dir="${qedeq.se.dest}/src/results/junit/${QedeqModule}/buffer"/>
  	<mkdir dir="${qedeq.se.dest}/src/results/junit/${QedeqModule}/generated"/>
  	<mkdir dir="${qedeq.se.dest}/src/results/junit/${QedeqModule}/config"/>
    <copy todir="${qedeq.se.dest}/src/results/junit/${QedeqModule}/config">
      <fileset file="${basedir}/QedeqGuiSe/src/config/*" excludes="**/log4j.properties"/>
      <filterset refid="qedeq_filter" />
    </copy>
    <junit fork="true" printsummary="yes" dir="${qedeq.se.dest}/src/results/junit/${QedeqModule}"
    	maxmemory="1024M">
      <classpath>
      	<path refid="classpath.common" />
      	<pathelement location="${qedeq.se.dest}/src/results/junit/${QedeqModule}" />
      	<pathelement location="${qedeq.se.dest}/src/results/junit/${QedeqModule}/config" />
     </classpath>
      <formatter type="plain" />
      <formatter type="xml" />
  	  <batchtest todir="${qedeq.se.dest}/src/results/junit/${QedeqModule}">
  	    <fileset dir="${qedeq.se.dest}/src/eclipse/${QedeqModule}Test/bin">
  	      <include name="**/*Test.class" />
    	  <exclude name="**/Abstract*Test.class" />
  	    </fileset>
  	  </batchtest>
    </junit>
  	<junitreport todir="${qedeq.se.dest}/src/results/junit/${QedeqModule}">
  	  <fileset dir="${qedeq.se.dest}/src/results/junit/${QedeqModule}">
  	  	<include name="TEST-*.xml" />
  	  </fileset>
  	  <report format="frames" todir="${qedeq.se.dest}/src/results/junit/${QedeqModule}"
  	  />
  	</junitreport>
  			
  </target>

  <target name="doc" depends="init">
  	<antcall target="makePdf" />
    <mkdir dir="${qedeq.se.dest}/doc" />
    <mkdir dir="${qedeq.se.dest}/doc/project" />
    <copy todir="${qedeq.se.dest}/doc/project">
      <fileset dir="${qedeq.se.gen}" 
        includes="clover/**" 
      />
    </copy>
    <copy todir="${qedeq.se.dest}/doc/project/clover">
      <fileset file="${qedeq.se.rel}/clovered.gif"
      />
    </copy>
  	<delete dir="${qedeq.se.dest}/xml" />
    <mkdir dir="${qedeq.se.dest}/xml" />
    <copy todir="${qedeq.se.dest}/xml">
      <fileset dir="${qedeq.se.gen}/xml" 
      />
    </copy>
    <copy todir="${qedeq.se.dest}">
      <fileset dir="${qedeq.se.rel}"
        includes="index.html"
      >
      </fileset>
      <filterset refid="qedeq_filter" />
    </copy>
    <copy todir="${qedeq.se.dest}/doc/project">
      <fileset dir="${qedeq.se.rel}"
        includes="changes.txt"
      >
      </fileset>
      <filterset refid="qedeq_filter" />
    </copy>
    <copy todir="${qedeq.se.dest}/doc">
      <fileset dir="${qedeq.gen.doc}"
        includes="math/**.xml,math/**.tex,math/**.pdf,project/**.xml,project/**.tex,project/**.pdf"
      	excludes="**/qedeq_sample1*"
      >
      </fileset>
    </copy>
    <copy todir="${qedeq.se.dest}/doc/math">
      <fileset dir="doc/description"
        includes="axiomatic_set_theory.txt"
      >
<!-- outdated:        includes="mengenlehre_1.tex,mengenlehre_1.pdf,axiomatic_set_theory.txt" -->
      </fileset>
    </copy>
    <copy todir="${qedeq.se.dest}/doc/project">
      <fileset dir="doc/description"
        includes="projektbeschreibung.tex,projektbeschreibung.pdf"
      >
      </fileset>
    </copy>
  </target>  


  <target name="javadoc" description="complete javadoc" depends="compileKernel,compileGui">
    <copy todir="${qedeq.se.temp}">
      <fileset dir="${qedeq.se.rel}" includes="overview.html"/>
      <filterset refid="qedeq_filter" />
    </copy>
  	<delete dir="${qedeq.se.dest}/src/javadoc" />
    <mkdir dir="${qedeq.se.dest}/src/javadoc" />
      <javadoc destdir="${qedeq.se.dest}/src/javadoc" 
      	       sourcepathref="srcpath.common"
               classpathref="classpath.common"
               access="package"
      		   packagenames="*"
               windowtitle="Hilbert II"
               doctitle="Hilbert II"
               overview="${qedeq.se.temp}/overview.html"
               use="true"
               splitindex="true"
               author="false"
               version="true"
      >
    <!--               stylesheetfile="${qedeq.se.rel}/stylesheet.css"  -->
            <link href="http://java.sun.com/j2se/1.4.2/docs/api/"/>
            <link href="http://java.sun.com/xml/jaxp-docs-1.0.1/docs/api/"/>
            <link href="http://jakarta.apache.org/log4j/docs/api/"/>
            <link href="http://java.sun.com/products/jdbc/jdbc20.stdext.javadoc/"/>
            <header><![CDATA[<b>Hilbert II - Version ${qedeq.working.version}</b>]]></header>
            <footer><![CDATA[<b>Hilbert II - Version ${qedeq.working.version}</b>]]></footer>
            <bottom><![CDATA[<table><td style="font-size:8pt"><a href="http://www.gnu.org/copyleft/gpl.html">&copy;left GNU General Public Licence</a><br> All Rights Reserved.</td></table>]]></bottom>
    </javadoc>
  </target>

  <target name="xsddoc" depends="doc">
    <mkdir dir="${qedeq.se.dest}/xml/qedeq"/>
    <xsddoc file="${qedeq.se.dest}/xml/qedeq.xsd"
	         out="${qedeq.se.dest}/xml/qedeq"
	    doctitle="XML QEDEQ Schema "
	     verbose="true"/>
  </target>	

  <target name="makePdf">
	<antcall target="makePdfCall">
		<param name="pdfdir" value="${qedeq.gen}/math"/>
		<param name="pdffile" value="qedeq_logic_v1_en.tex"/>
	</antcall>
	<antcall target="makePdfCall">
		<param name="pdfdir" value="${qedeq.gen}/math"/>
		<param name="pdffile" value="qedeq_logic_v1_de.tex"/>
	</antcall>
	<antcall target="makePdfCall">
		<param name="pdfdir" value="${qedeq.gen}/math"/>
		<param name="pdffile" value="qedeq_set_theory_v1_en.tex"/>
	</antcall>
	<antcall target="makePdfCall">
		<param name="pdfdir" value="${qedeq.gen}/math"/>
		<param name="pdffile" value="qedeq_set_theory_v1_de.tex"/>
	</antcall>
	<antcall target="makePdfCall">
		<param name="pdfdir" value="${qedeq.gen}/project"/>
		<param name="pdffile" value="qedeq_basic_concept_en.tex"/>
	</antcall>
	<antcall target="makePdfCall">
		<param name="pdfdir" value="${qedeq.gen}/project"/>
		<param name="pdffile" value="qedeq_basic_concept_de.tex"/>
	</antcall>
	<antcall target="makePdfCall">
		<param name="pdfdir" value="${qedeq.gen}/project"/>
		<param name="pdffile" value="qedeq_logic_language_en.tex"/>
	</antcall>
  </target>
	
  <target name="makePdfCall">
  	<exec executable="pdflatex">
  		<arg value="-output-directory" />
  	    <arg value="${pdfdir}" />
  	    <arg value="${pdfdir}/${pdffile}" />
  	</exec>
  	<exec executable="pdflatex">
  		<arg value="-output-directory" />
  	    <arg value="${pdfdir}" />
  	    <arg value="${pdfdir}/${pdffile}" />
  	</exec>
  </target>
	
  <target name="assemble" depends="compileKernel,compileGui,sourceKernel,sourceGui,doc,xsddoc">
    <delete dir="${qedeq.se.dest}/lib" />
    <mkdir dir="${qedeq.se.dest}/lib" />
    <copy todir="${qedeq.se.dest}/lib">
      <!-- fileset file="${qedeq.lib}/xalan.jar" / -->
      <fileset file="${qedeq.lib}/xercesImpl.jar" />
      <fileset file="${qedeq.lib}/xml-apis.jar" />
      <fileset file="${qedeq.lib}/commons-logging-1.1.jar" />
      <fileset file="${qedeq.lib}/log4j-1.2.14.jar" />
      <fileset file="${qedeq.lib}/forms-1.1.0.jar" />
      <fileset file="${qedeq.lib}/looks-2.1.4.jar" />
    </copy>
    <delete dir="${qedeq.se.dest}/license"/>
    <mkdir dir="${qedeq.se.dest}/license"/>
    <copy todir="${qedeq.se.dest}/license">
      <fileset file="${qedeq.se.rel}/gpl.html" />
      <fileset file="${qedeq.se.rel}/fdl.html" />
      <fileset file="${qedeq.se.rel}/*license.txt" />
      <filterset refid="qedeq_filter" />
    </copy>
    <delete dir="${qedeq.se.dest}/sample"/>
    <mkdir dir="${qedeq.se.dest}/sample"/>
    <copy todir="${qedeq.se.dest}/sample">
      <fileset dir="${qedeq.gen.doc}/project"
        includes="*.xml"
      >
      </fileset>
      <fileset dir="${qedeq.gen.doc}/math"
        includes="*.xml"
      >
      </fileset>
	  <fileset dir="${qedeq.se.test.data}"
	    includes="*_error.xml,qedeq_error_sample_*.xml,predlogic.xml,proplogic.xml"
	  >
	  </fileset>
    </copy>
    <delete dir="${qedeq.se.dest}/bin"/>
    <mkdir dir="${qedeq.se.dest}/bin"/>
    <copy todir="${qedeq.se.dest}/bin">
      <fileset dir="${qedeq.se.rel}/bin/" includes="*.bat,*.sh" excludes="qedeq_se.*,xml2*.*"/>
      <filterset refid="qedeq_filter" />
    </copy>
    <copy todir="${qedeq.se.dest}">
      <fileset dir="${qedeq.se.rel}/bin/" includes="qedeq_se.*"/>
      <filterset refid="qedeq_filter" />
    </copy>
    <copy todir="${qedeq.se.dest}">
      <fileset dir="${qedeq.rel.images}" includes="qedeq.*"/>
    </copy>
  	<delete dir="${qedeq.se.dest}/log"/>
    <mkdir dir="${qedeq.se.dest}/log"/>
  	<delete dir="${qedeq.se.dest}/config"/>
    <mkdir dir="${qedeq.se.dest}/config"/>
  	<delete dir="${qedeq.se.dest}/buffer"/>
    <mkdir dir="${qedeq.se.dest}/buffer"/>
    <copy todir="${qedeq.se.dest}/config">
      <fileset file="${basedir}/QedeqGuiSe/src/config/*" excludes="**/log4j.properties"/>
      <filterset refid="qedeq_filter" />
    </copy>
  </target>
  
  <target name="jarKernel" depends="compileKernel,sourceKernel,doc,assemble,javadoc">
    <delete dir="${qedeq.se.temp}" />
    <mkdir dir="${qedeq.se.temp}" />
    <copy todir="${qedeq.se.temp}">
      <fileset dir="${qedeq.se.rel}" includes="readme.txt"/>
      <filterset refid="qedeq_filter" />    	
    </copy>
    <copy todir="${qedeq.se.temp}">
      <fileset dir="${qedeq.se.rel}" includes="manifest*.txt">
      </fileset>
      <filterset refid="qedeq_filter" />    	
    </copy>

    <jar
     jarfile="${qedeq.se.dist}/qedeq_kernel_se_${qedeq.working.version}.jar"
     manifest="${qedeq.se.temp}/manifest.txt"
    >
        <fileset dir="${qedeq.se.dest}/src/eclipse/QedeqBase/bin"/>
        <fileset dir="${qedeq.se.dest}/src/eclipse/QedeqKernelSe/bin"/>
        <fileset dir="${qedeq.se.dest}/src/eclipse/QedeqKernelBo/bin"/>
        <fileset dir="${qedeq.se.dest}/src/eclipse/QedeqKernelXml/bin"/>
      <fileset dir="${qedeq.se.rel}" includes="gpl.txt"/>
      <fileset dir="${qedeq.se.temp}" includes="readme.txt"/>
    </jar>

    <copy file="${qedeq.se.dist}/qedeq_kernel_se_${qedeq.working.version}.jar" 
      tofile="${qedeq.se.dest}/lib/qedeq_kernel_se.jar"/>

  </target>

  <target name="jarGui" depends="compileGui,sourceGui,doc,assemble,javadoc">
    <delete dir="${qedeq.se.temp}" />
    <mkdir dir="${qedeq.se.temp}" />
    <copy todir="${qedeq.se.temp}">
      <fileset dir="${qedeq.se.rel}" includes="readme.txt"/>
      <filterset refid="qedeq_filter" />    	
    </copy>
    <copy todir="${qedeq.se.temp}">
      <fileset dir="${qedeq.se.rel}" includes="manifest*.txt">
      </fileset>
      <filterset refid="qedeq_filter" />    	
    </copy>

    <jar
     jarfile="${qedeq.se.dist}/qedeq_gui_se_${qedeq.working.version}.jar"
     manifest="${qedeq.se.temp}/manifest.txt"
    >
      <fileset dir="${qedeq.se.dest}/src/eclipse/QedeqGuiSe/bin"/>
      <fileset dir="${qedeq.se.rel}" includes="gpl.txt"/>
      <fileset dir="${qedeq.se.temp}" includes="readme.txt"/>
    </jar>

    <copy file="${qedeq.se.dist}/qedeq_gui_se_${qedeq.working.version}.jar" 
      tofile="${qedeq.se.dest}/lib/qedeq_gui_se.jar"/>

  </target>

  <target name="webstart" depends="jarKernel,jarGui" description="sign jars to be able to webstart">
    <delete dir="${qedeq.se.webstart}" />
    <mkdir dir="${qedeq.se.webstart}" />
    <copy todir="${qedeq.se.webstart}">
      <fileset dir="${qedeq.se.dest}/lib" />
    </copy>
	<signjar jar="${qedeq.se.webstart}/qedeq_kernel_se.jar" alias="qedeqkey"
      storepass="Iewsss#WhadUg" keystore="${qedeq.se.rel}/qedeqKey.bin"/>
	<signjar jar="${qedeq.se.webstart}/qedeq_gui_se.jar" alias="qedeqkey"
      storepass="Iewsss#WhadUg" keystore="${qedeq.se.rel}/qedeqKey.bin"/>
	<signjar jar="${qedeq.se.webstart}/commons-logging-1.1.jar" alias="qedeqkey"
      storepass="Iewsss#WhadUg" keystore="${qedeq.se.rel}/qedeqKey.bin"/>
	<signjar jar="${qedeq.se.webstart}/log4j-1.2.14.jar" alias="qedeqkey"
	  storepass="Iewsss#WhadUg" keystore="${qedeq.se.rel}/qedeqKey.bin"/>
	<signjar jar="${qedeq.se.webstart}/forms-1.1.0.jar" alias="qedeqkey"
	  storepass="Iewsss#WhadUg" keystore="${qedeq.se.rel}/qedeqKey.bin"/>
	<signjar jar="${qedeq.se.webstart}/looks-2.1.4.jar" alias="qedeqkey"
      storepass="Iewsss#WhadUg" keystore="${qedeq.se.rel}/qedeqKey.bin"/>
	<signjar jar="${qedeq.se.webstart}/xercesImpl.jar" alias="qedeqkey"
      storepass="Iewsss#WhadUg" keystore="${qedeq.se.rel}/qedeqKey.bin"/>
	<signjar jar="${qedeq.se.webstart}/xml-apis.jar" alias="qedeqkey"
      storepass="Iewsss#WhadUg" keystore="${qedeq.se.rel}/qedeqKey.bin"/>
    <copy todir="${qedeq.se.webstart}">
      <fileset file="${qedeq.se.rel}/qedeq.jnlp" />
      <filterset refid="qedeq_filter" />
    </copy>
    <copy todir="${qedeq.se.webstart}">
      <fileset file="${qedeq.rel.images}/splash.gif" />
      <fileset file="${qedeq.rel.images}/qedeq.png" />
    </copy>
  </target>
	
  <target name="release" depends="jarKernel,jarGui,sourceKernel,doc,assemble,javadoc">
    <!-- Windows -->
    <fixcrlf srcdir="${qedeq.se.dest}"
        eol="dos" 
        eof="remove"
        includes="**/*.sh,**/*.java,**/*.html,**/*.txt,**/*.properties,**/*.tex,**/*.xml,**/*.xsd"
    	excludes="**/xml/qedeq/**/*"
    />
    <zip whenempty="create"
      zipfile="${qedeq.se.dist}/qedeq_${qedeq.working.version}_win.zip"
    >
      <fileset dir="${qedeq.se.dest}/.." 
        includes="qedeq/**"
        excludes="**/classes/**" 
      />
    </zip>
  	
    <!-- Unix -->
    <fixcrlf srcdir="${qedeq.se.dest}"
         eol="unix" 
         eof="remove"
        includes="**/*.sh,**/*.java,**/*.html,**/*.txt,**/*.properties,**/*.tex,**/*.xml,**/*.xsd"
    	excludes="**/xml/qedeq/**/*"
    />
    <tar
      destfile="${qedeq.se.dist}/qedeq_${qedeq.working.version}_unx.tar.bz2"
      defaultexcludes="no"
      compression="bzip2"
    >
      <tarfileset dir="${qedeq.se.dest}/.." 
        excludes="**/*.sh,**/classes,**/classes/**/*" 
      />
      <tarfileset dir="${qedeq.se.dest}/.."
        mode="755"
        includes="**/*.sh" 
      />
    </tar>

    <!-- mac -->
<!--
    <fixcrlf srcdir="${qedeq.se.dest}"
         eol="mac" 
         eof="remove"
         includes="**/*.sh,**/*.java,**/*.html,**/*.txt,**/*.properties,**/*.tex,**/*.xml,**/*.xsd"
    />
    <zip whenempty="create"
      zipfile="${qedeq.se.dist}/qedeq_${qedeq.working.version}_mac.zip"
    >
      <fileset dir="${qedeq.se.dest}" 
        excludes="classes/**" 
      />
    </zip>
 -->
    
  </target>
	
  <target name="clean">
    <delete dir="${qedeq.se.dest}"/>
    <delete dir="${qedeq.se.dist}"/>
    <delete dir="${qedeq.se.temp}"/>
  </target>


  <target name="tidy">
    <delete>
      <fileset dir="${qedeq.se.dest}" defaultexcludes="no" includes="**/*~"/>
    </delete>
  </target>


  <target name="all"
	depends="clean,checkstyle,compileKernel,sourceDoc,compileGui,jarKernel,jarGui,test,javadoc,release,webstart">
  </target>

</project>


